10 REM MANDELBROT V0.3A
20 GOSUB 9000:GOTO 1000
30 X=X0:Y=Y0:K=0
40 Z=X:X=X*X-Y*Y+X0:Y=2*Y*Z+Y0
50 IF X*X+Y*Y>DI THEN 70
60 K=K+1:IF K<NI THEN 40
70 CC=K+1:X0=X0+XS:RETURN
990 REM *** MAIN LOOP
1000 FOR J=0 TO 95
1010 X0=XB:GCOL 15:MOVE 0,191:DRAW J*255/96,191
1020 FOR I=0 TO 248 STEP 8
1030 H=0:TC=0
1040 GOSUB 30
1050 IF CC<2 OR CC>NI THEN 1200
1060 TC=TC+CC
1070 IF H=3 THEN C=TC/4
1080 H=H+1:IF H<8 THEN 1040
1090 CC=TC/4-C:Q=15
1100 GOTO 1500
1200 N=H:Q=B(H)
1210 H=H+1:IF H=8 THEN 1250
1220 GOSUB 30
1230 IF CC<2 OR CC>NI THEN Q=Q+B(H) ELSE TC=TC+CC:N=N+1
1240 GOTO 1210
1250 IF N=0 THEN 1530
1260 C=TC/N:CC=0
1500 H0=I
1510 V0=95-J:GOSUB 2000
1520 V0=95+J:GOSUB 2000
1530 NEXT I
1540 Y0=Y0+YS:NEXT J
1550 GCOL 1:MOVE 0,191:DRAW 255,191:PRINT CHR$(7);
1560 GOTO 1560
1950 REM **************
1960 REM VDP WRITE:
1970 REM PATTERN P
1980 REM COLOR FG*16+BG
1990 REM **************
2000 BH=INT(V0/8):BL=INT(H0/8)*8+(V0 MOD 8)
2005 CX=PA(CC)*16+PA(C)
2010 GOSUB 3000
2020 CALL CODE
2030 RETURN
2990 REM *** INLINE ASSEMBLER
3000 DIM CODE 255
3010 P%=CODE
3020 [OPT 0
3025 RST &20
3030 LD A,BL
3040 OUT (191),A
3050 LD A,BH+64
3060 OUT (191),A
3070 LD A,Q
3080 OUT (190),A
3090 LD A,BL
3100 OUT (191),A
3110 LD A,BH+96
3120 OUT (191),A
3130 LD A,CX
3140 OUT (190),A
3145 RST &28
3150 RET
3160 ]
3170 RETURN
8000 REM ****************
8010 REM SEE MSX MAGAZINE
8020 REM NR.25 - SEP 1988
8030 REM
8040 REM + COLOR PALETTE
8050 REM + X RESOLUTION
8060 REM + OPTIMIZATION
8070 REM ****************
9000 RESTORE 9210
9010 DIM PA(16)
9020 FOR I=1 TO 16
9030 READ PA(I)
9040 NEXT I
9050 X1=-2.05:X2=0.7
9060 Y1=-1.18:Y2=1.18
9070 S1=256:REM SCREEN WIDTH (SCALE)
9080 NI=15:DI=4
9085 Y0=0
9090 XB=X1:XS=(X2-X1)/256:YB=0:YS=(Y2-Y1)/192
9100 DIM B(7):B(0)=128:B(1)=64:B(2)=32:B(3)=16:B(4)=8:B(5)=4:B(6)=2:B(7)=1
9110 GCOL 192:CLS
9120 GCOL 15:PLOT 255,191
9130 RETURN
9200 REM COLOR PALETTE:
9210 DATA 1,6,8,9,10,11,3,2,12,4,5,7,13,14,15,1
